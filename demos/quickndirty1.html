<!DOCTYPE html>
<html>
<head>
	<title>Change Camp Prototype</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<!-- Framework CSS -->
	<link rel="stylesheet" href="../css/blueprint/blueprint/screen.css" type="text/css" media="screen, projection">
	<link rel="stylesheet" href="../css/blueprint/blueprint/print.css" type="text/css" media="print">
	<!--[if IE]><link rel="stylesheet" href="../css/blueprint/blueprint/ie.css" type="text/css" media="screen, projection"><![endif]-->
	<link rel="stylesheet" href="style.css" type="text/css" media="screen" />
	<script src="../js/jquery-1.3.1.min.js" type="text/javascript"></script>
	<script type="text/javascript">
		$(document).ready(function(){
 			$('#geoError').hide();
		});
	</script>
	<script src="http://maps.google.com/maps?file=api&amp;v=2.x&amp;key=ABQIAAAAhKmW6TN0CiPqXCUjd9Y9sxTgtaT0YcsA7oWKq5sA2DUkHZo1FBTw33sYJQHUT6mFpnjr7QYaty53_w" type="text/javascript"></script>
	<script type="text/javascript">
		var map;
	    var geocoder;
	    var address;
	
	    function initialize() {
	    var center = new GLatLng(43.670233, -79.386755);
	      map = new GMap2(document.getElementById("map"));
	      map.enableContinuousZoom();
	      map.setCenter(center, 15);
	      map.addControl(new GLargeMapControl);
	      GEvent.addListener(map, "click", getAddress);
	      geocoder = new GClientGeocoder();
	      var marker = new GMarker(center,{draggable: true});
	    }
	    
	    function frontGeocode(address) 
	    {
			if (geocoder) {
				geocoder.getLocations(address, reverseGeocode);
			}
		}
	    
	    function getAddress(overlay, latlng) 
	    {
			if (latlng != null) {
				// if we're getting this from the click
				address = latlng;
				geocoder.getLocations(latlng, reverseGeocode);
			}
			if(latlng == null && overlay != undefined)
			{
				geocoder.getLocations(overlay, reverseGeocode);
			}
			//alert(overlay + latlng);
	    }
	
		function reverseGeocode(response) 
		{
			map.clearOverlays();
			if (!response || response.Status.code != 200) 
			{
				$('#geoError').fadeIn('fast');
			} 
			else 
			{
				place = response.Placemark[0];
				$('#address').val(place.address);
				point = new GLatLng(place.Point.coordinates[1],
				place.Point.coordinates[0]);
				marker = new GMarker(point,{draggable: true});
				map.addOverlay(marker);
				marker.openInfoWindowHtml(
				'<b>orig latlng:</b>' + response.name + '<br/>' + 
				'<b>latlng:</b>' + place.Point.coordinates[1] + "," + place.Point.coordinates[0] + '<br>' +
				'<b>Status Code:</b>' + response.Status.code + '<br>' +
				'<b>Status Request:</b>' + response.Status.request + '<br>' +
				'<b>Address:</b>' + place.address + '<br>' +
				'<b>Accuracy:</b>' + place.AddressDetails.Accuracy + '<br>' +
				'<b>Country code:</b> ' + place.AddressDetails.Country.CountryNameCode);
				GEvent.addListener(marker, "dragstart", function() {
					marker.closeInfoWindow();
				});
			GEvent.addListener(marker, "dragend", getAddress);
			map.panTo(point, 15);
			}
	  
    	}
	
    </script>
    <script language="text/javascript">
	/**
	 * DHTML textbox character counter script. Courtesy of SmartWebby.com (http://www.smartwebby.com/dhtml/)
	 */
	
	maxL=140;
	var bName = navigator.appName;
	function taLimit(taObj) {
		if (taObj.value.length==maxL) return false;
		return true;
	}
	
	function taCount(taObj,Cnt) { 
		objCnt=createObject(Cnt);
		objVal=taObj.value;
		if (objVal.length>maxL) objVal=objVal.substring(0,maxL);
		if (objCnt) {
			if(bName == "Netscape"){	
				objCnt.textContent=maxL-objVal.length;}
			else{objCnt.innerText=maxL-objVal.length;}
		}
		return true;
	}
	function createObject(objId) {
		if (document.getElementById) return document.getElementById(objId);
		else if (document.layers) return eval("document." + objId);
		else if (document.all) return eval("document.all." + objId);
		else return eval("document." + objId);
	}
	</script>
</head>
<body onload="initialize()" onunload="GUnload()">
<div class="container" id="airlock">
	<div class="span-24 last">
		<div class="span-24">
			<div id="column-a" class="span-10">
				<form id="findLocation" name="findLocation" action="#">
					<label for="address">I live at or near</label>
					<input type="text" class="span-10" id="address" name="address" onblur="frontGeocode(this.value); return false" value="The Mod Club, Toronto, ON" />
					<p class="error" id="geoError">Sorry! We couldn't find that location.</p>
				</form>
				<p class="and">- and -</p> 
				<form id="helloForm">
					<label for="message">I want to say</label>
					<textarea name="message" class="span-10" style="height: 75px;" onKeyPress="return taLimit(this)" onKeyUp="return taCount(this,'charactersLeft')"></textarea>
					<div class="span-5">
						<p id="charactersLeft">140 characters left</p>
					</div>
					<div class="subtext span-5 last">
						<label for="scope">about</label>
						<select name="scope"><option>my street</option><option>my city</option><option>my province</option><option>my country</option></select>
					</div>
				</form>
			</div>
			<div class="span-14 last">
				<div id="map" style="width:500px;height:309px"></div>
				<p>Click anywhere to put your pin in the map.</p>
			</div>
		</div>
		<div class="span-24">
			<h1>Todo/Notes:</h1>
			<ul>
				<li>Almost entirely cribbed from <a href="http://code.google.com/apis/maps/documentation/examples/geocoding-reverse.html">this example in google's documentation</a></li>
				<li>There's an annoying bug where it gives you a "can't geocode this" error (602) when you click the info window.</li>
				<li>The actual "problem" form doesn't do anything still. I know.</li>
				<li>All work and no play makes jack a dull boy.</li>
			</ul>
		</div>
	</div>
</div>
</body>
</html>
