<html>
<head>
	<title>Change Camp Prototype</title>
	<link rel="stylesheet" href="style.css" type="text/css" media="screen" />

	<!-- Framework CSS -->
	<link rel="stylesheet" href="../css/blueprint/blueprint/screen.css" type="text/css" media="screen, projection">
	<link rel="stylesheet" href="../css/blueprint/blueprint/print.css" type="text/css" media="print">
	<!--[if IE]><link rel="stylesheet" href="../css/blueprint/blueprint/ie.css" type="text/css" media="screen, projection"><![endif]-->

	<!-- Import fancy-type plugin for the sample page. -->
	<link rel="stylesheet" href="../css/blueprint/blueprint/plugins/fancy-type/screen.css" type="text/css" media="screen, projection">
	
	<script src="http://maps.google.com/maps?file=api&amp;v=2.x&amp;key=ABQIAAAAhKmW6TN0CiPqXCUjd9Y9sxTgtaT0YcsA7oWKq5sA2DUkHZo1FBTw33sYJQHUT6mFpnjr7QYaty53_w" type="text/javascript"></script>
	<script type="text/javascript">
		 var map;
	    var geocoder;
	    var address;
	
	    function initialize() {
	    var center = new GLatLng(43.670233, -79.386755);
	      map = new GMap2(document.getElementById("map"));
	      map.enableContinuousZoom();
	      map.setCenter(center, 15);
	      map.addControl(new GLargeMapControl);
	      GEvent.addListener(map, "click", getAddress);
	      geocoder = new GClientGeocoder();
	      var marker = new GMarker(center,{draggable: true});
	    }
	    
	    function frontGeocode(address) {
			if (geocoder) {
				geocoder.getLocations(address, reverseGeocode);
			}
		}
	    
	    function getAddress(overlay, latlng) {
	      if (latlng != null) {
	        address = latlng;
	        geocoder.getLocations(latlng, reverseGeocode);
	      }
	      else
	      {
	      	address = latlng;
	        geocoder.getLocations(overlay, reverseGeocode);
	      }
	      //alert("o: "+overlay+" l: "+latlng);
	    }
	
	    function reverseGeocode(response) {
	      map.clearOverlays();
	      if (!response || response.Status.code != 200) {
	        alert("Status Code:" + response.Status.code);
	      } else {
	        place = response.Placemark[0];
	        point = new GLatLng(place.Point.coordinates[1],
	                            place.Point.coordinates[0]);
	        marker = new GMarker(point,{draggable: true});
	        map.addOverlay(marker);
	        marker.openInfoWindowHtml(
	        '<b>orig latlng:</b>' + response.name + '<br/>' + 
	        '<b>latlng:</b>' + place.Point.coordinates[1] + "," + place.Point.coordinates[0] + '<br>' +
	        '<b>Status Code:</b>' + response.Status.code + '<br>' +
	        '<b>Status Request:</b>' + response.Status.request + '<br>' +
	        '<b>Address:</b>' + place.address + '<br>' +
	        '<b>Accuracy:</b>' + place.AddressDetails.Accuracy + '<br>' +
	        '<b>Country code:</b> ' + place.AddressDetails.Country.CountryNameCode);
	        GEvent.addListener(marker, "dragstart", function() {
		  		marker.closeInfoWindow();
		  	});
		  	GEvent.addListener(marker, "dragend", getAddress);
	      }
		  
	    }
	
    </script>
</head>
<body onload="initialize()" onunload="GUnload()">
<div class="container" id="airlock">
	<div class="span-24 last">
		<div class="span-24">
			<div id="column-a" class="span-10">
				<h2>#shamen geocoding demo 1</h2>
				<form id="findLocation" name="findLocation" action="#">
					<input type="text" size="27" name="address" value="1600 Amphitheatre Pky, Mountain View, CA" />
					<a href="#" style="border: 1px solid blue; padding: 3px;" onclick="frontGeocode(document.findLocation.address.value); return false">&raquo;</a>
				</form>
				<form id="helloForm">
					I have a <select><option>Problem</option><option>Question</option><option>Announcement</option></select><br> regarding <select><option>my street</option><option>my city</option><option>my province</option><option>my country</option></select><br>It goes like this: <br /><textarea style="width: 100%; height: 75px;"></textarea>
				</form>
			</div>
			<div class="span-14 last">
				<div id="map" style="width:500px;height:300px"></div>
				<p>Click anywhere to put your pin in the map.</p>
			</div>
		</div>
		<div class="span-24">
			<h1>Notes:</h1>
			<ul>
				<li>Entirely cribbed from <a href="http://code.google.com/apis/maps/documentation/examples/geocoding-reverse.html">this example in google's documentation</a></li>
				<li>There's an annoying bug where it gives you a "can't geocode this" error (602) when you click the info window.</li>
				<li>All work and no play makes jack a dull boy.</li>
			</ul>
		</div>
	</div>
</div>
</body>
</html>
